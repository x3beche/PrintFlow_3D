<app-sidebar></app-sidebar>
<div
  class="flex flex-col h-screen bg-neutral-900"
  [ngClass]="{ 'sm:ml-48': !sidebarCollapsed, 'sm:ml-12': sidebarCollapsed }"
>
  <app-header header_title="Order Page"></app-header>
  
  <!-- Main container -->
  <div class="flex-1 p-4 grid grid-cols-2 gap-3 bg-black overflow-auto">
    
    <!-- Left Panel - 3D Model Viewer -->
    <div class="bg-neutral-900 border border-zinc-700 p-4 hover:border-zinc-600 transition-colors duration-150 flex flex-col">
      <div class="flex items-center justify-between mb-4">
        <h2 class="font-inter text-xl font-semibold text-white">3D View of Current Uploaded Model</h2>
        <span class="font-inter text-sm text-neutral-400" *ngIf="uploadedFileName">{{ uploadedFileName }}</span>
      </div>
      
      <!-- Upload Area / 3D Viewer -->
      <div 
        class="flex-1 bg-neutral-800 border border-zinc-700 flex items-center justify-center min-h-[400px] hover:border-zinc-600 transition-colors duration-150 cursor-pointer"
        (dragover)="onDragOver($event)"
        (drop)="onDrop($event)"
        (click)="fileInput.click()"
      >
        <input 
          #fileInput 
          type="file" 
          class="hidden" 
          accept=".stl,.obj,.3mf"
          (change)="onFileSelected($event)"
        />
        
        <div class="text-center" *ngIf="!uploadedFile">
          <svg class="w-16 h-16 mx-auto text-neutral-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
          </svg>
          <p class="font-inter text-white font-medium mb-2">Upload your file to start process...</p>
          <p class="font-inter text-sm text-neutral-500">Drag & drop or click to browse (.stl, .obj, .3mf)</p>
        </div>

        <div class="text-center" *ngIf="uploadedFile">
          <svg class="w-20 h-20 mx-auto text-green-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <p class="font-inter text-white font-medium mb-2">{{ uploadedFileName }}</p>
          <p class="font-inter text-sm text-green-400">File uploaded successfully</p>
          <button 
            type="button"
            class="mt-4 px-4 py-2 bg-neutral-700 border border-zinc-600 text-white font-inter text-sm hover:bg-neutral-600 transition-colors duration-150"
            (click)="fileInput.click(); $event.stopPropagation()"
          >
            Change File
          </button>
        </div>
      </div>
    </div>

    <!-- Right Panel - Ordering Form -->
    <div class="bg-neutral-900 border border-zinc-700 p-6 hover:border-zinc-600 transition-colors duration-150 overflow-y-auto">
      <h2 class="font-inter text-2xl font-semibold text-white mb-6">Ordering Form</h2>
      
      <form [formGroup]="orderForm" (ngSubmit)="onSubmit()" class="space-y-6">
        
        <!-- Order Type & Material Row -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block font-inter text-sm font-medium text-white mb-2">Select Printing Technology</label>
            <select 
              formControlName="orderType"
              class="w-full bg-neutral-800 border border-zinc-700 text-white font-inter text-sm px-4 py-2.5 hover:border-zinc-600 focus:border-blue-400 focus:outline-none transition-colors duration-150"
            >
              <option *ngFor="let type of orderTypes" [value]="type">{{ type }}</option>
            </select>
          </div>
          
          <div>
            <label class="block font-inter text-sm font-medium text-white mb-2">Select Material</label>
            <select 
              formControlName="material"
              class="w-full bg-neutral-800 border border-zinc-700 text-white font-inter text-sm px-4 py-2.5 hover:border-zinc-600 focus:border-blue-400 focus:outline-none transition-colors duration-150"
            >
              <option *ngFor="let material of (isFDM ? fdmMaterials : slaMaterials)" [value]="material">
                {{ material }}
              </option>
            </select>
          </div>
        </div>

        <!-- Color & Brand Row -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block font-inter text-sm font-medium text-white mb-2">Select Color</label>
            <select 
              formControlName="color"
              class="w-full bg-neutral-800 border border-zinc-700 text-white font-inter text-sm px-4 py-2.5 hover:border-zinc-600 focus:border-blue-400 focus:outline-none transition-colors duration-150"
            >
              <option *ngFor="let color of colors" [value]="color">{{ color }}</option>
            </select>
          </div>
          
          <div>
            <label class="block font-inter text-sm font-medium text-white mb-2">Select Material Brand</label>
            <select 
              formControlName="brand"
              class="w-full bg-neutral-800 border border-zinc-700 text-white font-inter text-sm px-4 py-2.5 hover:border-zinc-600 focus:border-blue-400 focus:outline-none transition-colors duration-150"
            >
              <option *ngFor="let brand of brands" [value]="brand">{{ brand }}</option>
            </select>
          </div>
        </div>

        <!-- Layer Height & Bottom Texture Row (FDM Only) -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block font-inter text-sm font-medium text-white mb-2">Layer Height (mm)</label>
            <select 
              formControlName="layerHeight"
              class="w-full bg-neutral-800 border border-zinc-700 text-white font-inter text-sm px-4 py-2.5 hover:border-zinc-600 focus:border-blue-400 focus:outline-none transition-colors duration-150"
            >
              <option *ngFor="let height of layerHeights" [value]="height">{{ height }} mm</option>
            </select>
          </div>
          
          <div *ngIf="isFDM">
            <label class="block font-inter text-sm font-medium text-white mb-2">Select Bottom Texture</label>
            <select 
              formControlName="bottomTexture"
              class="w-full bg-neutral-800 border border-zinc-700 text-white font-inter text-sm px-4 py-2.5 hover:border-zinc-600 focus:border-blue-400 focus:outline-none transition-colors duration-150"
            >
              <option *ngFor="let texture of bottomTextures" [value]="texture">{{ texture }}</option>
            </select>
          </div>
        </div>

        <!-- Infill & Nozzle Size/Quantity Row -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block font-inter text-sm font-medium text-white mb-2">Infill (%)</label>
            <select 
              formControlName="infill"
              class="w-full bg-neutral-800 border border-zinc-700 text-white font-inter text-sm px-4 py-2.5 hover:border-zinc-600 focus:border-blue-400 focus:outline-none transition-colors duration-150"
            >
              <option *ngFor="let infill of infillOptions" [value]="infill">{{ infill }}%</option>
            </select>
          </div>
          
          <div *ngIf="isFDM">
            <label class="block font-inter text-sm font-medium text-white mb-2">Nozzle Size (mm)</label>
            <select 
              formControlName="nozzleSizes"
              class="w-full bg-neutral-800 border border-zinc-700 text-white font-inter text-sm px-4 py-2.5 hover:border-zinc-600 focus:border-blue-400 focus:outline-none transition-colors duration-150"
            >
              <option *ngFor="let size of nozzleSizes" [value]="size">{{ size }} mm</option>
            </select>
          </div>

          <div *ngIf="isSLA">
            <label class="block font-inter text-sm font-medium text-white mb-2">Quantity</label>
            <select 
              formControlName="quantity"
              class="w-full bg-neutral-800 border border-zinc-700 text-white font-inter text-sm px-4 py-2.5 hover:border-zinc-600 focus:border-blue-400 focus:outline-none transition-colors duration-150"
            >
              <option *ngFor="let qty of quantities" [value]="qty">{{ qty }} pcs</option>
            </select>
          </div>
        </div>

        <!-- Quantity Row for FDM -->
        <div *ngIf="isFDM">
          <label class="block font-inter text-sm font-medium text-white mb-2">Quantity</label>
          <select 
            formControlName="quantity"
            class="w-full bg-neutral-800 border border-zinc-700 text-white font-inter text-sm px-4 py-2.5 hover:border-zinc-600 focus:border-blue-400 focus:outline-none transition-colors duration-150"
          >
            <option *ngFor="let qty of quantities" [value]="qty">{{ qty }} pcs</option>
          </select>
        </div>

        <!-- Notes Section -->
        <div>
          <label class="block font-inter text-sm font-medium text-white mb-2">Notes</label>
          <textarea 
            formControlName="notes"
            rows="4" 
            placeholder="If you have any additional notes about the production process, you can submit them here."
            class="w-full bg-neutral-800 border border-zinc-700 text-white placeholder-neutral-500 font-inter text-sm px-4 py-2.5 hover:border-zinc-600 focus:border-blue-400 focus:outline-none transition-colors duration-150 resize-none"
          ></textarea>
        </div>

        <!-- Price Estimation Card -->
        <div class="bg-neutral-800 border border-zinc-700 border-l-4 border-l-green-500 p-4 hover:border-zinc-600 transition-colors duration-150">
          <h3 class="font-inter text-sm font-semibold text-white mb-3">Estimated Price and Filament Usage</h3>
          <div class="flex justify-between items-center" *ngIf="estimations">
            <span class="font-inter text-sm text-neutral-400">{{ estimations.estimated_weight }}gr filament will be used</span>
            <span class="font-inter text-xl font-semibold text-green-400">Estimated price {{ estimations.estimated_cost }} TL</span>
          </div>
          <div class="text-center" *ngIf="!estimations">
            <button 
              type="button"
              (click)="calculateEstimation()"
              class="font-inter text-sm text-blue-400 hover:text-blue-300 transition-colors duration-150"
            >
              Calculate Estimation
            </button>
          </div>
        </div>

        <!-- Submit Button -->
        <button 
          type="submit"
          [disabled]="orderForm.invalid || !uploadedFile"
          class="w-full bg-yellow-400 hover:bg-yellow-500 text-black font-inter font-semibold text-sm py-3 transition-colors duration-150 disabled:bg-neutral-700 disabled:text-neutral-500 disabled:cursor-not-allowed"
        >
          Submit Order
        </button>

        <!-- Validation Messages -->
        <div *ngIf="orderForm.invalid && orderForm.touched" class="bg-red-900/20 border border-red-700 border-l-4 border-l-red-500 p-3">
          <p class="font-inter text-sm text-red-400">Please fill all required fields before submitting.</p>
        </div>

        <div *ngIf="!uploadedFile && orderForm.touched" class="bg-yellow-900/20 border border-yellow-700 border-l-4 border-l-yellow-500 p-3">
          <p class="font-inter text-sm text-yellow-400">Please upload a 3D model file.</p>
        </div>
      </form>
    </div>

  </div>
</div>